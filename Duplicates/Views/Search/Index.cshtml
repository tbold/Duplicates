@{
    ViewBag.Title = "Search";
}


<script type="text/javascript">
    var uniqueIdentifier;
    $(document).ready(function () {
        activeTable = '#searchTable';
        $('.loading-screen').addClass('open');
        //wait for column names to be retreived before populating elements
        $.when(getColumnNames()).done(function () {
            //only one unique identifier is allowed
            $(':checkbox').on('change', function () {
                $(':checkbox').not(this).prop('checked', false);
                uniqueIdentifier = $("label[for='" + $(this).attr('id') + "']").attr('data-off-text');
            });

            $('#manual-card').click(function () {
                event.preventDefault();
                $('#search').addClass('open');
            });

            $('#search, #search button.close').on('click keyup', function (event) {
                if (event.target == this || event.target.className == 'close' || event.keyCode == 27) {
                    $(this).removeClass('open');
                }
            });

            //accordion effect on step-by-step sections
            var accordion = $('#accordion').children();
            for (var i = 0; i < accordion.length; i++) {
                accordion[i].addEventListener("click", function () {
                    var content = this.lastElementChild;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            }
           
            //prepare custom search form
            initSearchForm();

            //prepare checkboxes
            prepareCheckboxes();

            //prepare search cards
            prepareSearchCards();

            $('.loading-screen').removeClass('open');
        });
    });

    function submitAction() {
        $('.loading-screen').addClass('open');
        $('#search').removeClass('open');
        var parameters = {};
        parameters["uniqueID"] = uniqueIdentifier;
        parameters["first_name"] = "alfi";
        var result = (getSearchResults(parameters)).done(function () {
            $('.loading-screen').removeClass('open');
            $('#table-title').trigger('click');
        });
        event.preventDefault();
    }
    function prepareCheckboxes() {
        for (var i in htmlColumns) {
            $('#checkboxes').append('<div class="toggle-button toggle-button--vesi" id="toggle-' + i + '"></div>');
            $('#toggle-' + i).append('<input id="toggleButton' + i + '" type="checkbox">');
            $('#toggle-' + i).append('<label for="toggleButton' + i + '" data-on-text="unique ' + htmlColumns[i].data + '" data-off-text="' + htmlColumns[i].data + '"></label>');
            $('#toggle-' + i).append('<div class="toggle-button__icon"></div>');
        }
    }

    function prepareSearchCards() {
        for (var i in htmlColumns) {
            $('.cards').append('<div class="card" id=card-' + i + '></div>');
            $('#card-' + i).append('<div id="ilx56" class="card-header"></div>')
            $('#card-' + i).append('<div class="card-body"><div class="card-title">By ' + htmlColumns[i].data + '</div><div class="card-sub-title"> Find duplicate records by ' + htmlColumns[i].data + '</div><div class="card-desc"> ...</div></div>')
        }
    }

    function getSearchResults(list) {
        return $.ajax({
            url: "/Search/GetSearchResults",
            type: "POST",
            data: {
                parameters: list,
                filename: "MOCK_DATA"
            },
            error: function () {
                alert("no results");
            }
        }).done(function (data) {
            return prepareSearchResults(data);
        });
    }

    function prepareSearchResults(data) {
        $('#searchTable' + ' thead').empty().append('<tr></tr>');
        var table = $('#searchTable' + ' tr');
        for (var i in htmlColumns) {
            if (htmlColumns[i].data != null) {
                table.append('<th>' + htmlColumns[i].data + '</th>');
            }
        }
        showTable(data);
    }
    //initialise DataTable object to display on page
    function showTable(data) {
        $('#searchTable').DataTable({
            retrieve: true,
            data: data,
            columns: htmlColumns
        });
    }
    function initSearchForm() {
        for (var i in htmlColumns) {
            if (htmlColumns[i].data != uniqueIdentifier) {
                $('.search-form').append('<div class="search-group" id=column' + i + '></div>');
                $('#column' + i).append('<label for="' + htmlColumns[i].data + '" style="color:white">' + htmlColumns[i].data + ':</label>');
                $('#column' + i).append('<input id="' + htmlColumns[i].data + '" type="text" class="form-control" />');
            }
        }
        $('.search-form').append('<br /><button id="search-button" type="button" class="btn btn-primary" onclick="submitAction()">Search</button>');
    }
</script>

<div class="loading-screen">
    <div class="sk-folding-cube">
        <div class="sk-cube1 sk-cube"></div>
        <div class="sk-cube2 sk-cube"></div>
        <div class="sk-cube4 sk-cube"></div>
        <div class="sk-cube3 sk-cube"></div>
    </div>
</div>

<div id="accordion">
    <section class="section section--vesi" id="uniqueIdentifier">
        <div class="section__title"> Step 1: Select unique identifier </div>
        <div class="content" id="checkboxes">

        </div>
    </section>
    <section class="section section--vesi" id="search-cards" style="background-color: #c8c8c8">
        <div class="section__title" style="color: #555;">Step 2: Select search option</div>
        <div class="content" style="background-color: #c8c8c8">
            <div class="cards">
                <div class="card" id="manual-card">
                    <div class="card-header ch3">
                    </div>
                    <div class="card-body">
                        <div class="card-title">Manual Search</div>
                        <div class="card-sub-title">Find duplicate records by manual searching</div>
                        <div class="card-desc">...</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="section section--vesi" id="results" style="background-color: #fafafa">
        <div class="section__title" id="table-title" style="color: #000000;">Step 3: Review results</div>
        <div class="content" style="font-size: 12px; background-color: #fafafa">
            <table id="searchTable" class="table table-striped table-hover" style="min-width: 200px; color: black; font-size: 12px;" aria-live="polite">
                <thead>

                </thead>
            </table>
        </div>
    </section>
</div>



<div id="search" style="overflow-y: scroll">
    <button type="button" class="close">x</button>
    <form class="search-form">

    </form>
</div>